<data name="GP9 Portal Home Proyectos" inherit_id="portal.portal_my_home" priority="50">
  
  <xpath expr="//div[hasclass('o_portal_my_home')]" position="before">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet"/>
    <link href="https://cdn.jsdelivr.net/npm/@n8n/chat/dist/style.css" rel="stylesheet"/>
    
    <style type="text/css">
      :root{--gp9-font:'Inter',-apple-system,BlinkMacSystemFont,sans-serif;--gp9-primary:#6366f1;--gp9-primary-light:#818cf8;--gp9-primary-glow:rgba(99,102,241,0.4);--gp9-success:#10b981;--gp9-success-light:#34d399;--gp9-warning:#f59e0b;--gp9-warning-light:#fbbf24;--gp9-danger:#ef4444;--gp9-danger-light:#f87171;--gp9-white:#fff;--gp9-gray-50:#f8fafc;--gp9-gray-100:#f1f5f9;--gp9-gray-200:#e2e8f0;--gp9-gray-300:#cbd5e1;--gp9-gray-400:#94a3b8;--gp9-gray-500:#64748b;--gp9-gray-600:#475569;--gp9-gray-700:#334155;--gp9-gray-800:#1e293b;--gp9-gray-900:#0f172a;--gp9-glass-bg:rgba(255,255,255,0.85);--gp9-glass-border:rgba(255,255,255,0.4);--chat-primary:#1e293b;--chat-primary-light:#334155}

      /* CHAT */
      .n8n-chat{font-family:var(--gp9-font)!important;z-index:9999!important}
      .n8n-chat .chat-toggle,.n8n-chat .chat-window-toggle,.n8n-chat [class*="toggle"]{width:56px!important;height:56px!important;background:var(--chat-primary)!important;border:none!important;border-radius:50%!important;box-shadow:0 4px 20px rgba(30,41,59,0.4)!important;transition:all .2s!important}
      .n8n-chat .chat-toggle:hover,.n8n-chat [class*="toggle"]:hover{transform:scale(1.05)!important;background:var(--chat-primary-light)!important}
      .n8n-chat .chat-toggle svg,.n8n-chat [class*="toggle"] svg{width:24px!important;height:24px!important;color:#fff!important}
      .n8n-chat .chat-window{border-radius:20px!important;box-shadow:0 20px 50px rgba(0,0,0,0.2)!important;border:none!important;overflow:hidden!important}
      .n8n-chat .chat-header{padding:1.25rem 1.5rem!important;background:var(--chat-primary)!important}
      .n8n-chat .chat-header h1,.n8n-chat .chat-header .chat-title{font-size:1.1rem!important;font-weight:600!important;margin:0!important;color:#fff!important}
      .n8n-chat .chat-header p,.n8n-chat .chat-header .chat-subtitle{font-size:.8rem!important;opacity:.85!important;color:#fff!important}
      .n8n-chat .chat-body{background:#fff!important;padding:1rem!important}
      .n8n-chat .chat-message-from-bot .chat-message-markdown{background:var(--gp9-gray-100)!important;color:var(--gp9-gray-800)!important;border-radius:0 1rem 1rem 1rem!important;padding:.75rem 1rem!important;font-size:.875rem!important}
      .chat-message-from-user{background:var(--chat-primary)!important;border-radius:1rem 1rem 0 1rem!important;padding:.75rem 1rem!important;max-width:85%!important;margin-left:auto!important}
      .chat-message-from-user .chat-message-markdown,.chat-message-from-user p{color:#fff!important;font-size:.875rem!important}
      .n8n-chat .chat-input,.n8n-chat .chat-inputs-container{border-top:1px solid var(--gp9-gray-200)!important;padding:.875rem!important;background:#fff!important}
      .n8n-chat textarea{border:1.5px solid var(--gp9-gray-200)!important;border-radius:12px!important;padding:.625rem .875rem!important;background:var(--gp9-gray-50)!important}
      .n8n-chat textarea:focus{border-color:var(--chat-primary)!important;box-shadow:0 0 0 3px rgba(30,41,59,0.1)!important;outline:none!important;background:#fff!important}
      .n8n-chat .chat-input button{background:var(--chat-primary)!important;border:none!important;border-radius:10px!important}
      .n8n-chat .chat-input button:hover{background:var(--chat-primary-light)!important}
      .n8n-chat .chat-footer{font-size:.65rem!important;color:var(--gp9-gray-400)!important;background:var(--gp9-gray-50)!important}

      /* PORTAL BASE */
      #wrapwrap,.o_portal{background:linear-gradient(135deg,#f0f4ff 0%,#faf5ff 50%,#f0fdfa 100%)!important;min-height:100vh}
      .o_portal_wrap{position:relative;min-height:calc(100vh - 200px);padding-bottom:2rem}
      .o_portal_wrap::before{content:'';position:fixed;inset:0;background-image:radial-gradient(rgba(99,102,241,0.04) 1px,transparent 1px);background-size:20px 20px;pointer-events:none;z-index:0}
      .o_portal_wrap&gt;*{position:relative;z-index:1}
      @media(min-width:992px){.o_portal_wrap&gt;.container&gt;.row&gt;.col-lg-6:first-child,.o_portal_wrap .col-lg-6:has(.o_portal_my_home){flex:0 0 73%!important;max-width:73%!important}#o_my_sidebar{flex:0 0 25%!important;max-width:25%!important}}
      @media(max-width:991.98px){.o_portal_wrap&gt;.container&gt;.row&gt;.col-lg-6:first-child,.o_portal_wrap .col-lg-6:has(.o_portal_my_home),#o_my_sidebar{flex:0 0 100%!important;max-width:100%!important;width:100%!important}#o_my_sidebar{margin-top:2rem}}

      /* HEADER */
      .gp9-portal-section{font-family:var(--gp9-font)}.gp9-portal-section *{font-family:inherit}
      .gp9-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:2rem;flex-wrap:wrap;gap:1rem}
      .gp9-header-left{display:flex;align-items:center;gap:1rem}
      .gp9-header-right{display:flex;align-items:center;gap:.75rem}
      .gp9-title{font-size:2rem;font-weight:300;color:var(--gp9-gray-800);letter-spacing:-.025em;margin:0}.gp9-title span{font-weight:600}
      .gp9-btn-ver-todos{display:inline-flex;align-items:center;gap:.5rem;padding:.625rem 1.25rem;font-size:.875rem;font-weight:500;color:var(--gp9-gray-600);background:var(--gp9-white);border:1px solid var(--gp9-gray-200);border-radius:100px;text-decoration:none;transition:all .2s;box-shadow:0 1px 3px rgba(0,0,0,0.04)}
      .gp9-btn-ver-todos:hover{color:var(--gp9-primary);border-color:var(--gp9-primary);background:rgba(99,102,241,0.05);transform:translateX(4px);text-decoration:none}
      .gp9-btn-ver-todos i{font-size:.75rem;transition:transform .2s}.gp9-btn-ver-todos:hover i{transform:translateX(2px)}

      /* NOTIFICACIONES */
      .gp9-notifications-wrapper{position:relative}
      .gp9-btn-notifications{position:relative;display:inline-flex;align-items:center;justify-content:center;width:44px;height:44px;background:var(--gp9-white);border:1px solid var(--gp9-gray-200);border-radius:12px;cursor:pointer;transition:all .2s;box-shadow:0 1px 3px rgba(0,0,0,0.04)}
      .gp9-btn-notifications:hover{border-color:var(--gp9-primary);background:rgba(99,102,241,0.05);transform:translateY(-2px)}
      .gp9-btn-notifications.is-active{border-color:var(--gp9-primary);background:rgba(99,102,241,0.1)}
      .gp9-btn-notifications i{font-size:1.1rem;color:var(--gp9-gray-600);transition:color .2s}
      .gp9-btn-notifications:hover i,.gp9-btn-notifications.is-active i{color:var(--gp9-primary)}
      .gp9-notif-badge{position:absolute;top:-4px;right:-4px;min-width:20px;height:20px;padding:0 6px;background:linear-gradient(135deg,var(--gp9-danger),var(--gp9-danger-light));color:var(--gp9-white);font-size:.7rem;font-weight:700;border-radius:100px;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 8px rgba(239,68,68,0.3);animation:gp9-pulse 2s infinite}
      @keyframes gp9-pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}
      .gp9-notifications-dropdown{position:absolute;top:calc(100% + 8px);right:0;width:400px;max-height:520px;background:var(--gp9-white);border-radius:16px;box-shadow:0 10px 40px rgba(0,0,0,0.15);opacity:0;visibility:hidden;transform:translateY(-10px);transition:all .25s cubic-bezier(0.4,0,0.2,1);z-index:1000;overflow:hidden}
      .gp9-notifications-dropdown.is-open{opacity:1;visibility:visible;transform:translateY(0)}
      .gp9-notif-header{display:flex;align-items:center;justify-content:space-between;padding:1rem 1.25rem;border-bottom:1px solid var(--gp9-gray-100);background:var(--gp9-gray-50)}
      .gp9-notif-header h4{margin:0;font-size:.9rem;font-weight:600;color:var(--gp9-gray-800);display:flex;align-items:center;gap:.5rem}.gp9-notif-header h4 i{color:var(--gp9-primary)}
      .gp9-btn-mark-all{font-size:.75rem;color:var(--gp9-primary);background:none;border:none;cursor:pointer;padding:.25rem .5rem;border-radius:6px;font-weight:500;transition:background .2s}.gp9-btn-mark-all:hover{background:rgba(99,102,241,0.1)}
      .gp9-notif-tabs{display:flex;border-bottom:1px solid var(--gp9-gray-100);padding:0 .5rem;background:var(--gp9-white)}
      .gp9-notif-tab{flex:1;padding:.75rem 1rem;font-size:.8rem;font-weight:500;color:var(--gp9-gray-500);background:none;border:none;cursor:pointer;position:relative;transition:color .2s;display:flex;align-items:center;justify-content:center;gap:.5rem}
      .gp9-notif-tab:hover{color:var(--gp9-gray-700)}.gp9-notif-tab.is-active{color:var(--gp9-primary)}
      .gp9-notif-tab.is-active::after{content:'';position:absolute;bottom:-1px;left:0;right:0;height:2px;background:var(--gp9-primary);border-radius:2px 2px 0 0}
      .gp9-notif-tab-badge{min-width:18px;height:18px;padding:0 5px;background:var(--gp9-gray-200);color:var(--gp9-gray-600);font-size:.65rem;font-weight:600;border-radius:100px;display:inline-flex;align-items:center;justify-content:center}
      .gp9-notif-tab.is-active .gp9-notif-tab-badge{background:rgba(99,102,241,0.15);color:var(--gp9-primary)}
      .gp9-notif-panel{display:none;max-height:350px;overflow-y:auto;padding:.5rem}.gp9-notif-panel.is-active{display:block}
      .gp9-notif-panel::-webkit-scrollbar{width:5px}.gp9-notif-panel::-webkit-scrollbar-thumb{background:var(--gp9-gray-200);border-radius:100px}
      .gp9-notif-section-title{padding:.5rem .75rem;font-size:.7rem;font-weight:600;color:var(--gp9-gray-400);text-transform:uppercase;letter-spacing:.05em;display:flex;align-items:center;gap:.5rem}
      .gp9-notif-item{display:flex;gap:.75rem;padding:.75rem;border-radius:10px;text-decoration:none;transition:background .2s;margin-bottom:.25rem;position:relative}
      .gp9-notif-item:hover{background:var(--gp9-gray-50);text-decoration:none}
      .gp9-notif-item.is-unread{background:rgba(99,102,241,0.04)}.gp9-notif-item.is-unread:hover{background:rgba(99,102,241,0.08)}
      .gp9-notif-icon{flex-shrink:0;width:36px;height:36px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:.9rem}
      .gp9-notif-icon--chat{background:rgba(99,102,241,0.1);color:var(--gp9-primary)}
      .gp9-notif-icon--invoice{background:rgba(16,185,129,0.1);color:var(--gp9-success)}
      .gp9-notif-icon--quote{background:rgba(139,92,246,0.1);color:#8b5cf6}
      .gp9-notif-content{flex:1;min-width:0}
      .gp9-notif-title{font-size:.8rem;font-weight:500;color:var(--gp9-gray-800);margin-bottom:.15rem;line-height:1.3}.gp9-notif-item.is-unread .gp9-notif-title{font-weight:600}
      .gp9-notif-project{font-size:.7rem;color:var(--gp9-primary);font-weight:500;margin-bottom:.15rem;display:flex;align-items:center;gap:.3rem}
      .gp9-notif-desc{font-size:.75rem;color:var(--gp9-gray-500);line-height:1.4;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
      .gp9-notif-dot{position:absolute;top:50%;right:.75rem;transform:translateY(-50%);width:7px;height:7px;background:var(--gp9-primary);border-radius:50%}
      .gp9-notif-empty{padding:2.5rem 1.5rem;text-align:center}.gp9-notif-empty i{font-size:2rem;color:var(--gp9-gray-300);margin-bottom:.75rem}.gp9-notif-empty p{margin:0;color:var(--gp9-gray-500);font-size:.85rem}
      .gp9-notif-footer{padding:.75rem 1.25rem;border-top:1px solid var(--gp9-gray-100);text-align:center;background:var(--gp9-gray-50)}
      .gp9-btn-view-all{display:inline-flex;align-items:center;gap:.5rem;font-size:.8rem;font-weight:500;color:var(--gp9-primary);text-decoration:none;padding:.4rem .8rem;border-radius:8px;transition:background .2s}.gp9-btn-view-all:hover{background:rgba(99,102,241,0.1);text-decoration:none}

      /* ========== GRID - CSS COLUMNS (MASONRY REAL) ========== */
      .gp9-projects-grid{column-count:3;column-gap:1.25rem}
      @media(max-width:1199.98px){.gp9-projects-grid{column-count:2;column-gap:1rem}}
      @media(max-width:767.98px){.gp9-projects-grid{column-count:1}.gp9-title{font-size:1.5rem}.gp9-header{flex-direction:column;align-items:flex-start;gap:.75rem}.gp9-header-right{width:100%;justify-content:space-between}.gp9-notifications-dropdown{width:calc(100vw - 2rem);right:-1rem}}

      /* CARDS */
      .gp9-card{position:relative;background:var(--gp9-glass-bg);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);border-radius:16px;border:1px solid var(--gp9-glass-border);overflow:hidden;transition:all .3s cubic-bezier(0.4,0,0.2,1);break-inside:avoid;margin-bottom:1.25rem;display:inline-block;width:100%;animation:gp9-fade-in .5s ease forwards;opacity:0}
      .gp9-card:nth-child(1){animation-delay:.05s}.gp9-card:nth-child(2){animation-delay:.1s}.gp9-card:nth-child(3){animation-delay:.15s}.gp9-card:nth-child(4){animation-delay:.2s}.gp9-card:nth-child(5){animation-delay:.25s}.gp9-card:nth-child(6){animation-delay:.3s}
      @keyframes gp9-fade-in{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
      .gp9-card--success{box-shadow:0 4px 20px rgba(16,185,129,0.1)}.gp9-card--success:hover{box-shadow:0 12px 36px rgba(16,185,129,0.18);transform:translateY(-4px)}
      .gp9-card--warning{box-shadow:0 4px 20px rgba(245,158,11,0.1)}.gp9-card--warning:hover{box-shadow:0 12px 36px rgba(245,158,11,0.18);transform:translateY(-4px)}
      .gp9-card--danger{box-shadow:0 4px 20px rgba(239,68,68,0.1)}.gp9-card--danger:hover{box-shadow:0 12px 36px rgba(239,68,68,0.18);transform:translateY(-4px)}
      .gp9-card::before{content:'';position:absolute;left:0;top:0;bottom:0;width:4px}
      .gp9-card--success::before{background:linear-gradient(180deg,var(--gp9-success),var(--gp9-success-light))}
      .gp9-card--warning::before{background:linear-gradient(180deg,var(--gp9-warning),var(--gp9-warning-light))}
      .gp9-card--danger::before{background:linear-gradient(180deg,var(--gp9-danger),var(--gp9-danger-light))}
      .gp9-card-body{padding:1.5rem;padding-left:1.75rem}
      .gp9-card-header{display:flex;justify-content:space-between;align-items:flex-start;gap:.75rem;margin-bottom:.5rem}
      .gp9-card-title{font-size:1.125rem;font-weight:600;color:var(--gp9-gray-800);margin:0;line-height:1.3}
      .gp9-badge{display:inline-flex;align-items:center;gap:.35rem;padding:.35rem .7rem;font-size:.7rem;font-weight:600;text-transform:uppercase;letter-spacing:.02em;border-radius:100px;white-space:nowrap}
      .gp9-badge--success{color:var(--gp9-success);background:rgba(16,185,129,0.12)}
      .gp9-badge--warning{color:#b45309;background:rgba(245,158,11,0.12)}
      .gp9-badge--danger{color:var(--gp9-danger);background:rgba(239,68,68,0.12)}
      .gp9-badge i{font-size:.55rem}
      .gp9-stage{display:inline-flex;align-items:center;gap:.5rem;font-size:.8rem;color:var(--gp9-gray-500);margin-bottom:1rem}.gp9-stage i{font-size:.7rem;opacity:.7}
      .gp9-info-row{display:flex;align-items:center;gap:1.5rem;margin-bottom:1rem;padding:.75rem 1rem;background:var(--gp9-gray-50);border-radius:10px;flex-wrap:wrap}
      .gp9-info-item-inline{display:flex;align-items:center;gap:.5rem;font-size:.8rem;color:var(--gp9-gray-600)}.gp9-info-item-inline i{color:var(--gp9-gray-400);font-size:.75rem;width:1rem}.gp9-info-item-inline strong{color:var(--gp9-gray-700);font-weight:600}
      .gp9-progress-section{margin-bottom:1.25rem}
      .gp9-progress-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem}
      .gp9-progress-label{font-size:.7rem;font-weight:600;color:var(--gp9-gray-400);text-transform:uppercase;letter-spacing:.05em}
      .gp9-progress-value{font-size:.875rem;font-weight:700;color:var(--gp9-gray-700)}
      .gp9-progress-track{height:6px;background:var(--gp9-gray-100);border-radius:100px;overflow:hidden}
      .gp9-progress-bar{height:100%;border-radius:100px;transition:width 1s cubic-bezier(0.4,0,0.2,1);position:relative;overflow:hidden}
      .gp9-progress-bar::after{content:'';position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.4),transparent);animation:gp9-shimmer 2s infinite}
      @keyframes gp9-shimmer{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}
      .gp9-progress-bar--success{background:linear-gradient(90deg,var(--gp9-success),var(--gp9-success-light))}
      .gp9-progress-bar--warning{background:linear-gradient(90deg,var(--gp9-warning),var(--gp9-warning-light))}
      .gp9-progress-bar--danger{background:linear-gradient(90deg,var(--gp9-danger),var(--gp9-danger-light))}
      .gp9-actions{display:grid;grid-template-columns:1fr 1fr;gap:.5rem;margin-bottom:.75rem}
      .gp9-btn-action{display:inline-flex;align-items:center;justify-content:center;gap:.4rem;padding:.6rem .5rem;font-size:.75rem;font-weight:500;color:var(--gp9-gray-600);background:var(--gp9-white);border:1px solid var(--gp9-gray-200);border-radius:8px;text-decoration:none;transition:all .2s}
      .gp9-btn-action:hover{color:var(--gp9-primary);border-color:var(--gp9-primary);background:rgba(99,102,241,0.05);text-decoration:none}.gp9-btn-action i{font-size:.75rem;opacity:.7}
      .gp9-actions-secondary{display:grid;grid-template-columns:1fr 1fr;gap:.5rem;margin-bottom:1rem}
      .gp9-btn-secondary{display:inline-flex;align-items:center;justify-content:center;gap:.35rem;padding:.5rem .4rem;font-size:.7rem;font-weight:500;color:var(--gp9-gray-500);background:transparent;border:1px dashed var(--gp9-gray-200);border-radius:8px;text-decoration:none;transition:all .2s}
      .gp9-btn-secondary:hover{color:var(--gp9-primary);border-color:var(--gp9-primary);border-style:solid;background:rgba(99,102,241,0.03);text-decoration:none}.gp9-btn-secondary i{font-size:.7rem;opacity:.6}
      .gp9-btn-toggle{width:100%;display:inline-flex;align-items:center;justify-content:center;gap:.5rem;padding:.7rem 1rem;font-size:.8rem;font-weight:500;color:var(--gp9-gray-500);background:var(--gp9-gray-50);border:none;border-radius:10px;cursor:pointer;transition:all .2s}
      .gp9-btn-toggle:hover{color:var(--gp9-gray-700);background:var(--gp9-gray-100)}
      .gp9-btn-toggle.is-active{color:var(--gp9-primary);background:rgba(99,102,241,0.1)}
      .gp9-btn-toggle i{font-size:.6rem;transition:transform .3s}.gp9-btn-toggle.is-active i{transform:rotate(180deg)}
      .gp9-details{display:none;margin-top:1rem}
      .gp9-details.is-open{display:block}
      .gp9-details-content{padding-top:1rem;border-top:1px solid var(--gp9-gray-100)}
      .gp9-status-msg{display:flex;align-items:flex-start;gap:.75rem;padding:.875rem 1rem;border-radius:10px;margin-bottom:1rem;font-size:.8rem;line-height:1.5}
      .gp9-status-msg--success{background:rgba(16,185,129,0.08);color:var(--gp9-gray-700)}
      .gp9-status-msg--warning{background:rgba(245,158,11,0.08);color:var(--gp9-gray-700)}
      .gp9-status-msg--danger{background:rgba(239,68,68,0.08);color:var(--gp9-gray-700)}
      .gp9-status-msg i{font-size:1rem;margin-top:.1rem}
      .gp9-status-msg--success i{color:var(--gp9-success)}.gp9-status-msg--warning i{color:var(--gp9-warning)}.gp9-status-msg--danger i{color:var(--gp9-danger)}
      .gp9-info-item{display:flex;align-items:center;gap:.625rem;font-size:.8rem;color:var(--gp9-gray-600);margin-bottom:.5rem}.gp9-info-item i{width:1rem;color:var(--gp9-gray-400);font-size:.75rem}
      .gp9-team{margin-bottom:1rem}
      .gp9-team-label{display:flex;align-items:center;gap:.5rem;font-size:.7rem;font-weight:600;color:var(--gp9-gray-400);text-transform:uppercase;letter-spacing:.05em;margin-bottom:.5rem}
      .gp9-team-list{display:flex;flex-wrap:wrap;gap:.4rem}
      .gp9-team-member{display:inline-flex;align-items:center;padding:.3rem .65rem;font-size:.7rem;font-weight:500;color:var(--gp9-gray-600);background:var(--gp9-white);border:1px solid var(--gp9-gray-200);border-radius:100px}
      .gp9-notes{padding:.75rem 1rem;background:var(--gp9-gray-50);border-radius:10px;border-left:3px solid var(--gp9-primary-light);font-size:.8rem;color:var(--gp9-gray-600);line-height:1.6;margin-bottom:1rem}
      .gp9-btn-project{width:100%;display:inline-flex;align-items:center;justify-content:center;gap:.5rem;padding:.8rem 1.25rem;font-size:.85rem;font-weight:600;color:var(--gp9-white);background:var(--gp9-primary);border:none;border-radius:10px;text-decoration:none;transition:all .2s;box-shadow:0 4px 12px var(--gp9-primary-glow)}
      .gp9-btn-project:hover{transform:translateY(-2px);box-shadow:0 6px 20px var(--gp9-primary-glow);color:var(--gp9-white);text-decoration:none}.gp9-btn-project i{font-size:.7rem;transition:transform .2s}.gp9-btn-project:hover i{transform:translateX(4px)}

      /* ODOO OVERRIDES */
      .o_portal .list-group-item[href*="/my/tasks"],.o_portal .list-group-item[href*="/my/task"],.o_portal .list-group-item[href*="/my/timesheets"],.o_portal .list-group-item[href*="/my/timesheet"],.o_portal .list-group-item[href*="/my/signatures"],.o_portal .list-group-item[href*="/my/signature"],.o_portal .list-group-item[href*="/my/sign"]{display:none!important}
      .o_portal_my_home h3{font-family:var(--gp9-font)!important;font-size:1.5rem!important;font-weight:300!important;color:var(--gp9-gray-800)!important;margin-top:3rem!important;margin-bottom:1.5rem!important}.o_portal_my_home h3 strong,.o_portal_my_home h3 b{font-weight:600!important}
      .o_portal_docs.list-group,.o_portal .list-group{font-family:var(--gp9-font)!important;background:var(--gp9-glass-bg)!important;backdrop-filter:blur(10px)!important;border-radius:16px!important;box-shadow:0 4px 24px rgba(0,0,0,0.06)!important;border:1px solid var(--gp9-glass-border)!important;overflow:hidden!important;padding:.5rem!important}
      .o_portal_docs .list-group-item,.o_portal .list-group-item{font-family:var(--gp9-font)!important;display:flex!important;align-items:center!important;justify-content:space-between!important;border:none!important;padding:1rem 1.25rem!important;margin:.25rem 0!important;border-radius:10px!important;background:transparent!important;color:var(--gp9-gray-700)!important;font-weight:500!important;font-size:.9375rem!important;transition:all .2s!important;text-decoration:none!important}
      .o_portal .list-group-item:hover{background:var(--gp9-white)!important;box-shadow:0 2px 8px rgba(0,0,0,0.04)!important;transform:translateX(4px)!important;color:var(--gp9-primary)!important}
      .o_portal .list-group-item .badge{background:linear-gradient(135deg,var(--gp9-gray-700),var(--gp9-gray-800))!important;color:var(--gp9-white)!important;border-radius:100px!important;padding:.375rem .75rem!important;font-weight:600!important;font-size:.75rem!important}
      #o_my_sidebar .o_portal_my_details,.o_portal_my_details{font-family:var(--gp9-font)!important;background:var(--gp9-glass-bg)!important;backdrop-filter:blur(10px)!important;border-radius:16px!important;box-shadow:0 4px 24px rgba(0,0,0,0.06)!important;padding:1.5rem!important;border:1px solid var(--gp9-glass-border)!important;margin-bottom:1.5rem!important}
      #o_my_sidebar .o_portal_my_details h4,.o_portal_my_details h4{font-family:var(--gp9-font)!important;font-size:.7rem!important;font-weight:600!important;color:var(--gp9-gray-500)!important;text-transform:uppercase!important;letter-spacing:.1em!important;margin-bottom:1rem!important;padding-bottom:.75rem!important;border-bottom:1px solid var(--gp9-gray-100)!important}
      .o_portal_my_details address{font-style:normal!important;color:var(--gp9-gray-600)!important;line-height:1.8!important;font-size:.875rem!important}.o_portal_my_details hr{display:none!important}
      #o_my_sidebar .o_portal_my_security,.o_portal_my_security{font-family:var(--gp9-font)!important;background:var(--gp9-glass-bg)!important;backdrop-filter:blur(10px)!important;border-radius:16px!important;box-shadow:0 4px 24px rgba(0,0,0,0.06)!important;padding:1.5rem!important;border:1px solid var(--gp9-glass-border)!important}
      .o_portal_my_security h4{font-family:var(--gp9-font)!important;font-size:.7rem!important;font-weight:600!important;color:var(--gp9-gray-500)!important;text-transform:uppercase!important;letter-spacing:.1em!important;margin-bottom:.75rem!important;padding-bottom:.5rem!important;border-bottom:1px solid var(--gp9-gray-100)!important}
      .o_portal_my_security hr{display:none!important}.o_portal_my_security a{color:var(--gp9-primary)!important;text-decoration:none!important;font-weight:500!important;font-size:.875rem!important}
      #wrapwrap footer,.o_portal footer,footer{position:relative!important;z-index:10!important;background:var(--gp9-gray-900)!important;margin-top:4rem!important}
    </style>

    <!-- Datos -->
    <t t-set="partner_id" t-value="request.env.user.partner_id.id"/>
    <t t-set="projects" t-value="request.env['project.project'].sudo().search([('partner_id','=', partner_id), ('active','=', True)], limit=6, order='create_date desc')"/>
    <t t-set="projects_list" t-value="list(projects)"/>
    <t t-set="project_ids" t-value="[p.id for p in projects_list]"/>
    <t t-set="chat_messages" t-value="request.env['x_portal_message'].sudo().search([('x_project_id', 'in', project_ids), ('x_is_from_staff', '=', True), ('x_confirmacion_lectura', '=', False)], limit=15, order='create_date desc')"/>
    <t t-set="invoices" t-value="request.env['account.move'].sudo().search([('partner_id', '=', partner_id), ('move_type', 'in', ['out_invoice', 'out_refund']), ('state', '=', 'posted')], limit=10, order='invoice_date desc')"/>
    <t t-set="quotations" t-value="request.env['sale.order'].sudo().search([('partner_id', '=', partner_id), ('state', 'in', ['sent', 'draft'])], limit=10, order='date_order desc')"/>
    <t t-set="unread_msg_count" t-value="len(chat_messages)"/>
    <t t-set="total_unread" t-value="unread_msg_count + len(invoices) + len(quotations)"/>

    <t t-if="projects_list">
      <div class="gp9-portal-section">
        <div class="gp9-header">
          <div class="gp9-header-left"><h2 class="gp9-title"><span>Mis Proyectos</span></h2></div>
          <div class="gp9-header-right">
            <div class="gp9-notifications-wrapper">
              <button type="button" class="gp9-btn-notifications" id="gp9NotifBtn">
                <i class="fa fa-bell-o"/>
                <t t-if="total_unread and total_unread &gt; 0"><span class="gp9-notif-badge"><t t-esc="total_unread if total_unread &lt; 10 else '9+'"/></span></t>
              </button>
              <div class="gp9-notifications-dropdown" id="gp9NotifDropdown">
                <div class="gp9-notif-header"><h4><i class="fa fa-bell"/>Notificaciones</h4><button type="button" class="gp9-btn-mark-all" id="gp9MarkAllRead">Marcar leído</button></div>
                <div class="gp9-notif-tabs">
                  <button type="button" class="gp9-notif-tab is-active" data-tab="projects"><i class="fa fa-folder-open-o"/>Proyectos</button>
                  <button type="button" class="gp9-notif-tab" data-tab="admin"><i class="fa fa-file-text-o"/>Admin</button>
                </div>
                <div class="gp9-notif-panel is-active" id="gp9PanelProjects">
                  <t t-if="chat_messages">
                    <div class="gp9-notif-section-title"><i class="fa fa-comments"/>Mensajes</div>
                    <t t-foreach="chat_messages" t-as="msg">
                      <a t-attf-href="/my/project/#{msg.x_project_id.id}#chat" t-attf-class="gp9-notif-item #{'' if msg.x_confirmacion_lectura else 'is-unread'}" t-att-data-msg-id="msg.id">
                        <div class="gp9-notif-icon gp9-notif-icon--chat"><i class="fa fa-comment"/></div>
                        <div class="gp9-notif-content">
                          <t t-if="msg.x_project_id"><div class="gp9-notif-project"><t t-esc="msg.x_project_id.name"/></div></t>
                          <div class="gp9-notif-title">Nuevo mensaje</div>
                        </div>
                        <t t-if="not msg.x_confirmacion_lectura"><span class="gp9-notif-dot"/></t>
                      </a>
                    </t>
                  </t>
                  <t t-else=""><div class="gp9-notif-empty"><i class="fa fa-comments-o"/><p>Sin mensajes</p></div></t>
                </div>
                <div class="gp9-notif-panel" id="gp9PanelAdmin">
                  <t t-if="invoices or quotations">
                    <t t-if="invoices"><div class="gp9-notif-section-title"><i class="fa fa-file-text"/>Facturas</div>
                      <t t-foreach="invoices[:3]" t-as="inv">
                        <a t-attf-href="/my/invoices/#{inv.id}" class="gp9-notif-item"><div class="gp9-notif-icon gp9-notif-icon--invoice"><i class="fa fa-file-text-o"/></div><div class="gp9-notif-content"><div class="gp9-notif-title"><t t-esc="inv.name or 'Factura'"/></div></div></a>
                      </t>
                    </t>
                  </t>
                  <t t-else=""><div class="gp9-notif-empty"><i class="fa fa-file-text-o"/><p>Sin documentos</p></div></t>
                </div>
                <div class="gp9-notif-footer"><a href="/my/projects" class="gp9-btn-view-all">Ver todos<i class="fa fa-arrow-right"/></a></div>
              </div>
            </div>
            <a href="/my/projects" class="gp9-btn-ver-todos">Ver todos <i class="fa fa-arrow-right"/></a>
          </div>
        </div>

        <div class="gp9-projects-grid">
          <t t-foreach="projects_list" t-as="p">
            <t t-set="prog" t-value="int(p.x_progress or 0)"/>
            <t t-set="risk" t-value="p.x_risk_level or 'low'"/>
            <t t-set="uid" t-value="p.id"/>
            <t t-set="risk_class" t-value="'success' if risk == 'low' else ('warning' if risk == 'medium' else 'danger')"/>
            <div t-attf-class="gp9-card gp9-card--#{risk_class}">
              <div class="gp9-card-body">
                <div class="gp9-card-header">
                  <h3 class="gp9-card-title"><t t-esc="p.name"/></h3>
                  <t t-if="risk == 'low'"><span class="gp9-badge gp9-badge--success"><i class="fa fa-check"/>OK</span></t>
                  <t t-elif="risk == 'medium'"><span class="gp9-badge gp9-badge--warning"><i class="fa fa-exclamation"/>Atención</span></t>
                  <t t-else=""><span class="gp9-badge gp9-badge--danger"><i class="fa fa-times"/>Riesgo</span></t>
                </div>
                <div class="gp9-stage"><i class="fa fa-bookmark-o"/><span><t t-esc="p.x_portal_stage_name or 'Sin etapa'"/></span></div>
                <div class="gp9-info-row"><div class="gp9-info-item-inline"><i class="fa fa-calendar-check-o"/><span>Entrega:</span><strong><t t-if="p.date"><t t-esc="p.date"/></t><t t-else="">Por definir</t></strong></div></div>
                <div class="gp9-progress-section">
                  <div class="gp9-progress-header"><span class="gp9-progress-label">Progreso</span><span class="gp9-progress-value"><t t-esc="prog"/>%</span></div>
                  <div class="gp9-progress-track"><div t-attf-class="gp9-progress-bar gp9-progress-bar--#{risk_class}" t-attf-style="width: #{prog}%;"/></div>
                </div>
                <div class="gp9-actions">
                  <a class="gp9-btn-action" t-attf-href="/my/project/#{p.id}#chat"><i class="fa fa-comment-o"/>Chat</a>
                  <a class="gp9-btn-action" t-attf-href="/my/project/#{p.id}#documents"><i class="fa fa-folder-o"/>Docs</a>
                </div>
                <div class="gp9-actions-secondary">
                  <a class="gp9-btn-secondary" t-attf-href="/my/project/#{p.id}#deliveries"><i class="fa fa-truck"/>Entregas</a>
                  <a class="gp9-btn-secondary" t-attf-href="/my/project/#{p.id}#meeting"><i class="fa fa-calendar"/>Reunión</a>
                </div>
                <button type="button" class="gp9-btn-toggle" t-attf-data-target="gp9-details-#{uid}"><span class="gp9-btn-text">Ver detalles</span><i class="fa fa-chevron-down"/></button>
                <div class="gp9-details" t-attf-id="gp9-details-#{uid}">
                  <div class="gp9-details-content">
                    <div t-attf-class="gp9-status-msg gp9-status-msg--#{risk_class}">
                      <t t-if="risk == 'low'"><i class="fa fa-check-circle"/><span>Todo en orden.</span></t>
                      <t t-elif="risk == 'medium'"><i class="fa fa-exclamation-circle"/><span>En seguimiento.</span></t>
                      <t t-else=""><i class="fa fa-times-circle"/><span>Requiere atención.</span></t>
                    </div>
                    <t t-if="p.date_start or p.date"><div class="gp9-info-item"><i class="fa fa-calendar"/><span><t t-if="p.date_start"><t t-esc="p.date_start"/></t><t t-if="p.date_start and p.date"> → </t><t t-if="p.date"><t t-esc="p.date"/></t></span></div></t>
                    <t t-if="p.partner_id"><div class="gp9-info-item"><i class="fa fa-user"/><span><t t-esc="p.partner_id.name"/></span></div></t>
                    <t t-if="p.x_studio_empleados_asignados_al_proyecto"><div class="gp9-team"><div class="gp9-team-label"><i class="fa fa-users"/>Equipo</div><div class="gp9-team-list"><t t-foreach="p.x_studio_empleados_asignados_al_proyecto" t-as="emp"><span class="gp9-team-member"><t t-esc="emp.name"/></span></t></div></div></t>
                    <t t-if="p.x_client_visible_notes"><div class="gp9-notes"><t t-out="p.x_client_visible_notes"/></div></t>
                    <a class="gp9-btn-project" t-attf-href="/my/project/#{p.id}">Ir al proyecto <i class="fa fa-arrow-right"/></a>
                  </div>
                </div>
              </div>
            </div>
          </t>
        </div>
      </div>

      <script>
      (function(){
        document.querySelectorAll('.gp9-btn-toggle').forEach(function(btn){
          btn.addEventListener('click',function(e){
            e.preventDefault();
            var target=document.getElementById(this.getAttribute('data-target'));
            if(!target)return;
            var isOpen=target.classList.contains('is-open');
            target.classList.toggle('is-open');
            this.classList.toggle('is-active');
            var txt=this.querySelector('.gp9-btn-text');
            if(txt)txt.innerText=isOpen?'Ver detalles':'Ocultar';
          });
        });
        var nb=document.getElementById('gp9NotifBtn'),nd=document.getElementById('gp9NotifDropdown');
        if(nb&amp;&amp;nd){nb.addEventListener('click',function(e){e.preventDefault();e.stopPropagation();nd.classList.toggle('is-open');nb.classList.toggle('is-active');});document.addEventListener('click',function(e){if(!nb.contains(e.target)&amp;&amp;!nd.contains(e.target)){nd.classList.remove('is-open');nb.classList.remove('is-active');}});}
        document.querySelectorAll('.gp9-notif-tab').forEach(function(t){t.addEventListener('click',function(){var n=this.getAttribute('data-tab');document.querySelectorAll('.gp9-notif-tab').forEach(function(x){x.classList.remove('is-active');});document.querySelectorAll('.gp9-notif-panel').forEach(function(x){x.classList.remove('is-active');});this.classList.add('is-active');document.getElementById(n==='projects'?'gp9PanelProjects':'gp9PanelAdmin').classList.add('is-active');});});
          
          // Función para marcar mensaje como leído via AJAX
          function markMessageRead(msgId){
            var xhr=new XMLHttpRequest();
            xhr.open('POST','/web/dataset/call_kw',true);
            xhr.setRequestHeader('Content-Type','application/json');
            xhr.send(JSON.stringify({
              jsonrpc:'2.0',
              method:'call',
              params:{
                model:'x_portal_message',
                method:'write',
                args:[[parseInt(msgId)],{x_confirmacion_lectura:true}],
                kwargs:{}
              }
            }));
          }

          // Marcar mensaje individual con mousedown (se ejecuta antes del click)
          document.querySelectorAll('.gp9-notif-item[data-msg-id]').forEach(function(item){
            item.addEventListener('mousedown',function(){
              var msgId=this.getAttribute('data-msg-id');
              if(msgId){markMessageRead(msgId);}
            });
          });

          // Marcar todo como leído
          var ma=document.getElementById('gp9MarkAllRead');
          if(ma){
            ma.addEventListener('click',function(){
              document.querySelectorAll('.gp9-notif-item[data-msg-id]').forEach(function(i){
                var msgId=i.getAttribute('data-msg-id');
                if(msgId){markMessageRead(msgId);}
                i.classList.remove('is-unread');
                var d=i.querySelector('.gp9-notif-dot');
                if(d)d.style.display='none';
              });
              document.querySelectorAll('.gp9-notif-badge').forEach(function(b){b.style.display='none';});
            });
          }
      })();
      </script>
    </t>
    
    <script type="module">
      import{createChat}from'https://cdn.jsdelivr.net/npm/@n8n/chat/dist/chat.bundle.es.js';
      createChat({webhookUrl:'https://gp9chat.app.n8n.cloud/webhook/chatgp9-v3-prod/chat',mode:'window',showWelcomeScreen:!1,loadPreviousSession:!1,initialMessages:[],i18n:{en:{title:'ChatGP9',subtitle:'Asistente GP9',footer:'',getStarted:'Nueva conversación',inputPlaceholder:'Escribe...',closeButtonTooltip:'Cerrar'}}});
      var s=document.createElement('style');s.textContent='.chat-message-from-user{background:#1e293b!important;border-radius:1rem 1rem 0 1rem!important;padding:.75rem 1rem!important}.chat-message-from-user .chat-message-markdown,.chat-message-from-user p{color:#fff!important}';document.head.appendChild(s);
    </script>
    
  </xpath>
  
</data>